<h6>Players interactions</h6>

@if (PlayersVm != null)
{
    <table class="table table-dark table-draft align-middle pb-0">
        <thead>
            <tr>
                <th scope="col" style="width: 200px">Player</th>
                @foreach (var (player, _) in PlayersVm)
                {
                    <th scope="col" style="width: 100px">
                        <a href="@RouteProvider.GetPlayerRoute(LeagueId, player)" class="text-inherit">@player</a>
                    </th>
                }
            </tr>
        </thead>
        <tbody>
            @foreach (var (player, playersInteractions) in PlayersVm)
            {
                <tr>
                    <th scope="row">
                        <a href="@RouteProvider.GetPlayerRoute(LeagueId, player)" class="text-inherit">@player</a>
                    </th>
                    @foreach (var (enemy, _) in PlayersVm)
                    {
                        @if (playersInteractions != null && playersInteractions.TryGetValue(enemy, out var interactions))
                        {
                            @if (IsAverage)
                            {
                                interactions /= interactions.Games;
                            }
                            <td class="@(interactions.Value > 0 ? "bg-success-subtle" : interactions.Value < -5 ? "bg-danger-subtle" : "") text-nowrap tt" ontouchstart="">
                                <div>@($"{Math.Round(interactions.Value, Decimals)} / {Math.Round(interactions.Total, Decimals)}")</div>
                                @if (ShowGames)
                                {
                                    @if (IsAverage)
                                    {
                                        <div class="fs-8">@($"G: {Math.Round(100 * interactions.Neighbors, Decimals)}%")</div>
                                    }
                                    else
                                    {
                                        <div class="fs-8">@($"G: {Math.Round(interactions.Neighbors, Decimals)} / {Math.Round(interactions.Games, Decimals)}")</div>
                                    }
                                }
                                <div class="tt-inner" style="width: 220px;">
                                    <ul class="list-group list-group-flush">
                                        @if (interactions.Supports > 0)
                                        {
                                            <li class="list-group-item bg-dark text-success">
                                                <b>Supports:</b>
                                                <span>@Math.Round(interactions.Supports, Decimals)</span>
                                            </li>
                                        }
                                        @if (interactions.WasSupported > 0)
                                        {
                                            <li class="list-group-item bg-dark text-success">
                                                <b>Was supported:</b>
                                                <span>@Math.Round(interactions.WasSupported, Decimals)</span>
                                            </li>
                                        }
                                        @if (interactions.SuccessfulAttacks > 0)
                                        {
                                            <li class="list-group-item bg-dark text-danger">
                                                <b>Successful attacks:</b>
                                                <span>@Math.Round(interactions.SuccessfulAttacks, Decimals)</span>
                                            </li>
                                        }
                                        @if (interactions.LostDefenses > 0)
                                        {
                                            <li class="list-group-item bg-dark text-danger">
                                                <b>Lost defenses:</b>
                                                <span>@Math.Round(interactions.LostDefenses, Decimals)</span>
                                            </li>
                                        }
                                        @if (interactions.SupportsOpponent > 0)
                                        {
                                            <li class="list-group-item bg-dark text-danger">
                                                <b>Supports opponent:</b>
                                                <span>@Math.Round(interactions.SupportsOpponent, Decimals)</span>
                                            </li>
                                        }
                                        @if (interactions.WasSupportedOpponent > 0)
                                        {
                                            <li class="list-group-item bg-dark text-danger">
                                                <b>Opponent was supported:</b>
                                                <span>@Math.Round(interactions.WasSupportedOpponent, Decimals)</span>
                                            </li>
                                        }
                                        @if (interactions.LostAttacks > 0)
                                        {
                                            <li class="list-group-item bg-dark text-secondary">
                                                <b>Lost attacks:</b>
                                                <span>@Math.Round(interactions.LostAttacks, Decimals)</span>
                                            </li>
                                        }
                                        @if (interactions.SuccessfulDefenses > 0)
                                        {
                                            <li class="list-group-item bg-dark text-secondary">
                                                <b>Successful defenses:</b>
                                                <span>@Math.Round(interactions.SuccessfulDefenses, Decimals)</span>
                                            </li>
                                        }
                                    </ul>
                                    <ul class="list-group list-group-flush pt-1">
                                        <li class="list-group-item text-wrap bg-dark">
                                            @foreach (var (houses, games) in interactions.HousesGames)
                                            {
                                                @if (houses.Length < 2)
                                                    continue;

                                                var house0 = Houses.Parse(houses[0]);
                                                var house1 = Houses.Parse(houses[1]);

                                                @foreach (var gameId in games)
                                                {
                                                    <a href="@RouteProvider.GetGameRoute(LeagueId, gameId)" class="btn btn-group p-0 m-0 me-1 mb-1" style="width: 58px;">
                                                        <div class="btn px-1 py-0 border-1 border-black disabled @Houses.GetHouseClass(house0)">@houses[0]</div>
                                                        <div class="btn px-1 py-0 border-1 border-black disabled @Houses.GetHouseClass(house1)">@houses[1]</div>
                                                    </a>
                                                }
                                            }
                                        </li>
                                        @if (ShowGames)
                                        {
                                            @if (IsAverage)
                                            {
                                                <li class="list-group-item bg-dark">
                                                    <b>Neighbors:</b>
                                                    <span>@($"{Math.Round(100 * interactions.Neighbors, Decimals)}%")</span>
                                                </li>
                                            }
                                            else
                                            {
                                                <li class="list-group-item bg-dark">
                                                    <b>Neighbors:</b>
                                                    <span>@Math.Round(interactions.Neighbors, Decimals)</span>
                                                </li>
                                                <li class="list-group-item bg-dark">
                                                    <b>Games:</b>
                                                    <span>@Math.Round(interactions.Games, Decimals)</span>
                                                </li>
                                            }
                                        }
                                    </ul>
                                </div>
                            </td>
                        }
                        else
                        {
                            <td></td>
                        }
                    }
                </tr>
            }
        </tbody>
    </table>
}

@code {
    [Parameter]
    public string? LeagueId { get; set; }

    [Parameter]
    public KeyValuePair<string, PlayersInteractions?>[]? PlayersVm { get; set; }

    [Parameter]
    public int Decimals { get; set; }

    [Parameter]
    public bool IsAverage { get; set; }

    [Parameter]
    public bool ShowGames { get; set; } = true;

}
